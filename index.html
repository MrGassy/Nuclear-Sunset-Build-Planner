<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NUCLEAR_SUNSET.EXE // TTW_EDITION</title>
    <style>
        /* --- CORE VISUAL VARIABLES --- */
        :root { 
            --pip-color: #28ff28; 
            --pip-bg: #050f05; 
            --pip-border: #28ff28; 
            --danger-red: #ff4444; 
            --font-main: 'Courier New', Courier, monospace;
        }
        
        /* --- THEME OVERRIDES --- */
        body.theme-cw:not(.mode-hc) { --pip-color: #28ff28; --pip-border: #1a441a; --pip-bg: #050f05; }
        body.theme-mw:not(.mode-hc) { --pip-color: #ffb642; --pip-border: #44331a; --pip-bg: #0f0a05; }
        
        /* --- HARDERCORE MODE STYLES --- */
        body.mode-hc { 
            --pip-color: var(--danger-red); 
            --pip-border: #800; --pip-bg: #000; background-color: #000;
            animation: warningPulse 6s infinite ease-in-out;
            overflow: hidden;
        }

        /* --- GLOBAL CAPITALIZATION --- */
        * { text-transform: uppercase !important; box-sizing: border-box; }

        @keyframes warningPulse {
            0%, 100% { box-shadow: inset 0 0 50px rgba(255, 0, 0, 0); }
            50% { box-shadow: inset 0 0 80px rgba(255, 0, 0, 0.15); }
        }

        body { 
            background-color: #0a0a0a; color: var(--pip-color); 
            font-family: var(--font-main); margin: 0; 
            overflow: hidden; height: 100vh; font-size: 13px; 
        }

        /* GENERAL INPUT STYLING */
        input, button, select, textarea { 
            font-family: var(--font-main) !important; 
            background: transparent; color: var(--pip-color);
            border: none; border-bottom: 1px solid rgba(255,255,255,0.2);
            transition: all 0.2s ease;
        }
        input:focus, textarea:focus { 
            outline: none; border-bottom-color: var(--pip-color); 
            background: rgba(255,255,255,0.05);
        }
        select option { background: #000; color: var(--pip-color); }

        .wrapper { display: grid; grid-template-columns: 380px 1fr 360px; grid-template-rows: auto 1fr; height: 100vh; gap: 15px; padding: 15px; }
        
        header { grid-column: 1 / span 3; border: 2px solid var(--pip-color); padding: 15px; background: var(--pip-bg); }
        
        .hc-alert-bar { 
            display: none; justify-content: center; border: 2px solid var(--danger-red); 
            background: rgba(128, 0, 0, 0.3); padding: 6px; margin-bottom: 10px; 
            animation: blink 1s infinite; font-weight: bold; 
        }
        @keyframes blink { 50% { opacity: 0.5; } }

        .header-controls { display: flex; justify-content: space-between; align-items: center; gap: 40px; }
        .os-title { font-weight: bold; font-size: 1.5rem; letter-spacing: 2px; flex-shrink: 0; }
        
        .settings-block { display: flex; gap: 20px; align-items: center; flex-grow: 1; justify-content: flex-end; }
        .toggle-group { display: flex; border: 1px solid var(--pip-color); }
        .toggle-group button { border: none; padding: 6px 12px; cursor: pointer; font-size: 0.7rem; color: var(--pip-color); }
        .toggle-group button.active { background: var(--pip-color) !important; color: black !important; }

        .nuke-btn { 
            border: 1px solid var(--pip-color); color: var(--pip-color); padding: 5px 12px; 
            cursor: pointer; font-size: 1.2rem; transition: all 0.2s; 
        }
        .nuke-btn:hover { border-color: red; color: red; box-shadow: 0 0 10px rgba(255, 0, 0, 0.5); }

        section { border: 2px solid var(--pip-border); background: var(--pip-bg); padding: 18px; overflow: hidden; display: flex; flex-direction: column; }
        .scroll-v { overflow-y: auto; flex-grow: 1; padding-right: 5px; }
        
        /* --- COLLAPSIBLE HEADERS --- */
        .header-row { 
            display: flex; justify-content: space-between; align-items: center; 
            background: rgba(255,255,255,0.1); margin: 15px 0 10px; padding: 6px 12px; 
            font-weight: bold; border: 1px solid var(--pip-border); 
            cursor: pointer; transition: 0.2s; user-select: none;
        }
        .header-row:hover { background: rgba(255,255,255,0.2); }
        .header-row.completed { background: var(--pip-color); color: black; box-shadow: 0 0 15px var(--pip-color); }
        .header-row h2 { background: none; color: inherit; margin: 0; padding: 0; border: none; font-size: 0.8rem; pointer-events: none; }
        
        h2 { background: var(--pip-color); color: black; font-size: 0.8rem; text-align: center; margin: 15px 0 10px; padding: 4px; font-weight: bold; }
        
        .grid-tidy { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .grid-item { display: flex; align-items: center; gap: 8px; padding: 5px; border: 1px solid rgba(255,255,255,0.05); font-size: 0.7rem; }
        .grid-item span a { color: inherit; text-decoration: none; border-bottom: 1px dotted var(--pip-color); }
        .grid-item span a:hover { background: var(--pip-color); color: black; }
        .locked { opacity: 0.3; pointer-events: none; }

        .tab-nav { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab-nav button { flex: 1; padding: 8px; background: rgba(255,255,255,0.05); color: var(--pip-color); border: 1px solid var(--pip-border); cursor: pointer; font-size: 0.7rem; font-weight: bold; }
        .tab-nav button.active { background: var(--pip-color); color: black; }

        .ov-card { border: 1px solid var(--pip-border); padding: 10px; background: rgba(255,255,255,0.02); margin-bottom: 10px; }
        .ov-sub { font-weight: bold; border-bottom: 1px solid #333; margin-bottom: 5px; font-size: 0.75rem; display: block; }
        .ov-entry { font-size: 0.7rem; padding: 2px 0; display: flex; justify-content: space-between; }

        /* --- REFINED PROGRESSION TAB STYLES --- */
        .prog-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .prog-row { 
            display: flex; flex-direction: column; margin-bottom: 5px; 
            background: rgba(255,255,255,0.03); 
            border: 1px solid rgba(255,255,255,0.1); /* Subtle border */
            border-left: 4px solid var(--pip-color); 
            position: relative; padding: 8px; /* More padding */
            transition: all 0.2s ease;
        }
        /* Focus state for better readability when typing */
        .prog-row:focus-within {
            background: rgba(255,255,255,0.08);
            border-color: var(--pip-color);
            box-shadow: 0 0 10px rgba(40, 255, 40, 0.1);
        }
        .lvl-tag { 
            background: rgba(255,255,255,0.1); padding: 2px 6px; 
            font-weight: bold; font-size: 0.65rem; align-self: flex-start; margin-bottom: 4px;
        }
        /* Larger Font Inputs */
        .prog-row input:first-of-type {
            font-size: 1.1rem; /* Larger, readable size */
            font-weight: bold;
            color: var(--pip-color);
            margin-bottom: 4px;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }
        .prog-row input:last-of-type {
            font-size: 0.85rem; /* Notes readable but smaller */
            color: rgba(255,255,255,0.7); /* Slightly dimmed */
            font-style: italic;
            border-bottom: none;
        }

        .gear-card { border: 1px solid rgba(255,255,255,0.1); padding: 10px; margin-bottom: 10px; background: rgba(255,255,255,0.02); position: relative; }
        .action-btn { width: 100%; height: 35px; border: 1px solid var(--pip-color); color: var(--pip-color); cursor: pointer; font-weight: bold; margin-bottom: 10px; background: rgba(255,255,255,0.05); }
        .action-btn:hover { background: var(--pip-color); color: black; }

        .pip-search { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid var(--pip-border); color: var(--pip-color); padding: 10px; margin-bottom: 10px; font-size: 0.9rem; font-weight: bold; }

        .sticky-note { display: none; background: #ffff88; color: #000; padding: 10px; transform: rotate(-1.5deg); border: 1px solid #ccc; font-size: 0.65rem; margin-bottom: 10px; box-shadow: 2px 2px 5px rgba(0,0,0,0.3); font-weight: bold; text-transform: none !important; }
        .credits-box { font-size: 0.7rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: 10px; }
        #user-notes { flex: 1; background: rgba(0,0,0,0.4); border: 1px solid var(--pip-border); padding: 12px; font-size: 0.9rem; resize: none; line-height: 1.4; }
        
        .special-row { display: grid; grid-template-columns: 1fr 100px; align-items: center; margin-bottom: 6px; padding: 4px 0; border-bottom: 1px dotted rgba(255,255,255,0.1); }
        .special-controls { display: grid; grid-template-columns: 30px 40px 30px; align-items: center; text-align: center; }
        .special-btn { background: none; border: 1px solid var(--pip-color); color: var(--pip-color); width: 28px; height: 28px; cursor: pointer; font-weight: bold; }
        .special-btn:hover:not(:disabled) { background: var(--pip-color); color: black; }
    </style>
</head>
<body class="theme-cw" oninput="triggerAutosave()">

<div class="wrapper">
    <header>
        <div class="hc-alert-bar" id="hc-banner">HARDERCORE_OVERRIDE_ACTIVE</div>
        <div class="header-controls">
            <div class="os-title">NUCLEAR_SUNSET.EXE // TTW_EDITION</div>
            <div class="settings-block">
                <div class="toggle-group"><button id="btn-cw" class="active" onclick="setOrigin('CW')">CAPITAL WASTELAND</button><button id="btn-mw" onclick="setOrigin('MW')">MOJAVE DESERT</button></div>
                <div class="toggle-group"><button id="m-std" class="active" onclick="setMode('std')">STANDARD</button><button id="m-hc" onclick="setMode('hc')">HARDERCORE</button></div>
                <button onclick="purgeMemory()" class="nuke-btn" title="PURGE ALL MEMORY">â˜¢</button>
            </div>
        </div>
    </header>

    <section>
        <div class="scroll-v">
            <h2>IDENTITY</h2>
            <input type="text" id="char-name" placeholder="SUBJECT_NAME..." style="width:100%; font-size:1.5rem; font-weight:bold; margin-bottom:15px; border-bottom: 2px solid var(--pip-color);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>S.P.E.C.I.A.L.</h2>
                <div style="font-size:0.8rem; font-weight:bold;">PTS: <span id="pts-left">0</span></div>
            </div>
            <div id="special-list"></div>
            <h2>TAGS (MAX 3)</h2>
            <div id="tag-area" class="grid-tidy"></div>
            <h2 id="trait-header">INITIAL TRAITS</h2>
            <div id="trait-list"></div>
            <button id="add-trait-btn" class="action-btn" onclick="addTrait()">+ ADD TRAIT</button>
        </div>
    </section>

    <section>
        <div class="tab-nav">
            <button onclick="showTab('ov')" id="tab-btn-ov" class="active">OVERVIEW</button>
            <button onclick="showTab('prog')" id="tab-btn-prog">PROGRESSION</button>
            <button onclick="showTab('gear')" id="tab-btn-gear">LOADOUT</button>
            <button onclick="showTab('quests')" id="tab-btn-quests">QUESTS</button>
            <button onclick="showTab('coll')" id="tab-btn-coll">COLLECTIBLES</button>
            <button onclick="showTab('uni')" id="tab-btn-uni">UNIQUES</button>
        </div>

        <div id="tab-ov" class="tab-content scroll-v">
            <div id="ov-name" style="font-size:1.5rem; border-bottom:2px solid var(--pip-color); padding-bottom:5px; margin-bottom:10px;">NO_ID</div>
            <div id="ov-spec" style="display:flex; justify-content:space-between; text-align:center; margin-bottom:15px;"></div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div>
                    <div class="ov-card"><span class="ov-sub">TAGS</span><div id="ov-tags"></div></div>
                    <div class="ov-card"><span class="ov-sub">TRAITS</span><div id="ov-traits"></div></div>
                    <div class="ov-card"><span class="ov-sub">GEAR_LIST</span><div id="ov-gear"></div></div>
                </div>
                <div class="ov-card"><span class="ov-sub">PERK_EVOLUTION</span><div id="ov-perks"></div></div>
            </div>
        </div>

        <div id="tab-prog" class="tab-content scroll-v" style="display:none;">
            <div id="prog-list" class="prog-grid"></div>
            <h2>EXTRA REWARDS</h2>
            <div id="extra-perk-list" class="prog-grid"></div>
            <button class="action-btn" onclick="addExtraPerk()">+ ADD EXTRA PERK</button>
        </div>

        <div id="tab-gear" class="tab-content scroll-v" style="display:none;">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div><h2>WEAPONS</h2><div id="weapon-list"></div><button class="action-btn" onclick="addWeapon()">+ WEAPON</button></div>
                <div><h2>APPAREL</h2><div id="armor-list"></div><button class="action-btn" onclick="addArmor()">+ APPAREL</button></div>
            </div>
        </div>

        <div id="tab-quests" class="tab-content scroll-v" style="display:none;">
            <input type="text" id="quest-search-bar" class="pip-search" placeholder="SEARCH QUESTS..." oninput="searchQuests()">
            <div id="quest-list-container"></div>
        </div>
        
        <div id="tab-coll" class="tab-content scroll-v" style="display:none;"><div id="coll-list"></div></div>

        <div id="tab-uni" class="tab-content scroll-v" style="display:none;">
            <input type="text" id="uni-search-bar" class="pip-search" placeholder="SEARCH UNIQUE WEAPONS..." oninput="searchUniques()">
            <div id="unique-weapon-checklist"></div>
        </div>
    </section>

    <section>
        <h2 style="margin-top:0;">DWELLER_NOTES.LOG</h2>
        <div style="display:flex; gap:5px; margin-bottom:10px;">
            <button class="action-btn" style="margin-bottom:0; font-size:0.65rem;" onclick="exportJSON()">ðŸ’¾ SAVE_JSON</button>
            <button class="action-btn" style="margin-bottom:0; font-size:0.65rem;" onclick="document.getElementById('import-file').click()">ðŸ“‚ LOAD_JSON</button>
            <input type="file" id="import-file" style="display:none" onchange="importJSON(event)">
        </div>
        <textarea id="user-notes" placeholder="--- INPUT LOG DATA ---"></textarea>
        <div id="sync-status" style="font-size:0.6rem; text-align:right; opacity:0.6; margin-top:5px;">SYSTEM_SYNCED</div>
        
        <div class="credits-box">
            <div class="sticky-note" id="sysop-note" style="display:block; background:#ff4; color:#000;">
                !! STICKY NOTE !!<br>9:13AM, October 23, 2077,
                HARDERCORE.EXE HAS BEEN ACTIVATED! GOD HELP US ALL! F.A.O FINALCATALYST - VAULT-TEC R&D
            </div>
            <b>SOURCE: <a href="https://nuclearsunset.com" target="_blank" style="color:inherit;">NUCLEARSUNSET.COM</a></b><br>
            TEAM: DARKSOLARLEGEND, ORGASMICSNEEZE, DOKTORAKCEL, LIME, FINALCATALYST.
            <div style="font-size: 0.65rem; border-top:1px dotted var(--pip-color); margin-top:5px; padding-top:4px;"><b>CREATED AND MAINTAINED BY GASSY</b></div>
        </div>
    </section>
</div>

<script>
    // --- STATE VARIABLES ---
    let mode = 'std', origin = 'CW', special = { STR: 5, PER: 5, END: 5, CHA: 5, INT: 5, AGI: 5, LCK: 5 };
    const sKeys = ["STR", "PER", "END", "CHA", "INT", "AGI", "LCK"];
    const skills = ["BARTER", "BIG GUNS", "ENERGY WEAPONS", "EXPLOSIVES", "GUNS", "LOCKPICK", "MEDICINE", "MELEE WEAPONS", "REPAIR", "SCIENCE", "SNEAK", "SPEECH", "SURVIVAL", "UNARMED"];
    
    // --- PERSISTENCE OBJECT ---
    let regionalStorage = {
        'CW': { quests: [], colls: [] },
        'MW': { quests: [], colls: [] }
    };

    const questsData = {
        'CW': { 
            'MAIN QUEST': ['<a href="https://fallout.fandom.com/wiki/Escape!" target="_blank">ESCAPE!</a>', '<a href="https://fallout.fandom.com/wiki/Following_in_His_Footsteps" target="_blank">FOLLOWING IN HIS FOOTSTEPS</a>', '<a href="https://fallout.fandom.com/wiki/Galaxy_News_Radio" target="_blank">GALAXY NEWS RADIO</a>', '<a href="https://fallout.fandom.com/wiki/Scientific_Pursuits" target="_blank">SCIENTIFIC PURSUITS</a>', '<a href="https://fallout.fandom.com/wiki/Tranquility_Lane" target="_blank">TRANQUILITY LANE</a>', '<a href="https://fallout.fandom.com/wiki/The_Waters_of_Life" target="_blank">THE WATERS OF LIFE</a>', '<a href="https://fallout.fandom.com/wiki/Picking_Up_the_Trail" target="_blank">PICKING UP THE TRAIL</a>', '<a href="https://fallout.fandom.com/wiki/Rescue_from_Paradise" target="_blank">RESCUE FROM PARADISE</a>', '<a href="https://fallout.fandom.com/wiki/Finding_the_Garden_of_Eden" target="_blank">FINDING THE GARDEN OF EDEN</a>', '<a href="https://fallout.fandom.com/wiki/The_American_Dream" target="_blank">THE AMERICAN DREAM</a>', '<a href="https://fallout.fandom.com/wiki/Take_it_Back!" target="_blank">TAKE IT BACK!</a>'],
            'SIDE QUEST': ['<a href="https://fallout.fandom.com/wiki/Agatha%27s_Song" target="_blank">AGATHA\'S SONG</a>', '<a href="https://fallout.fandom.com/wiki/Big_Trouble_in_Big_Town" target="_blank">BIG TROUBLE IN BIG TOWN</a>', '<a href="https://fallout.fandom.com/wiki/Blood_Ties" target="_blank">BLOOD TIES</a>', '<a href="https://fallout.fandom.com/wiki/Head_of_State" target="_blank">HEAD OF STATE</a>', '<a href="https://fallout.fandom.com/wiki/Oasis_(quest)" target="_blank">OASIS</a>', '<a href="https://fallout.fandom.com/wiki/Reilly%27s_Rangers_(quest)" target="_blank">REILLY\'S RANGERS</a>', '<a href="https://fallout.fandom.com/wiki/Stealing_Independence" target="_blank">STEALING INDEPENDENCE</a>', '<a href="https://fallout.fandom.com/wiki/Strictly_Business" target="_blank">STRICTLY BUSINESS</a>', '<a href="https://fallout.fandom.com/wiki/Tenpenny_Tower_(quest)" target="_blank">TENPENNY TOWER</a>', '<a href="https://fallout.fandom.com/wiki/The_Nuka-Cola_Challenge" target="_blank">THE NUKA COLA CHALLENGE</a>', '<a href="https://fallout.fandom.com/wiki/The_Power_of_the_Atom_(Fallout_3)" target="_blank">THE POWER OF THE ATOM</a>', '<a href="https://fallout.fandom.com/wiki/The_Replicated_Man" target="_blank">THE REPLICATED MAN</a>', '<a href="https://fallout.fandom.com/wiki/The_Superhuman_Gambit" target="_blank">THE SUPERHUMAN GAMBIT</a>', '<a href="https://fallout.fandom.com/wiki/The_Wasteland_Survival_Guide" target="_blank">WASTELAND SURVIVAL GUIDE</a>', '<a href="https://fallout.fandom.com/wiki/Those!" target="_blank">THOSE!</a>', '<a href="https://fallout.fandom.com/wiki/Trouble_on_the_Homefront" target="_blank">TROUBLE ON THE HOMEFRONT</a>', '<a href="https://fallout.fandom.com/wiki/You_Gotta_Shoot_%27Em_in_the_Head" target="_blank">YOU GOTTA SHOOT \'EM IN THE HEAD</a>'],
            'DLC: OPERATION ANCHORAGE': ['<a href="https://fallout.fandom.com/wiki/Aiding_the_Outcasts" target="_blank">AIDING THE OUTCASTS</a>', '<a href="https://fallout.fandom.com/wiki/The_Guns_of_Anchorage" target="_blank">THE GUNS OF ANCHORAGE</a>', '<a href="https://fallout.fandom.com/wiki/Paving_the_Way" target="_blank">PAVING THE WAY</a>', '<a href="https://fallout.fandom.com/wiki/Operation:_Anchorage!_(quest)" target="_blank">OPERATION: ANCHORAGE!</a>'],
            'DLC: BROKEN STEEL': ['<a href="https://fallout.fandom.com/wiki/Death_From_Above" target="_blank">DEATH FROM ABOVE</a>', '<a href="https://fallout.fandom.com/wiki/Shock_Value" target="_blank">SHOCK VALUE</a>', '<a href="https://fallout.fandom.com/wiki/Who_Dares_Wins" target="_blank">WHO DARES WINS</a>', '<a href="https://fallout.fandom.com/wiki/Holy_Water" target="_blank">HOLY WATER</a>', '<a href="https://fallout.fandom.com/wiki/Protecting_the_Water_Way" target="_blank">PROTECTING THE WATER WAY</a>', '<a href="https://fallout.fandom.com/wiki/The_Amazing_Aqua_Cura!" target="_blank">THE AMAZING AQUA CURA!</a>'],
            'DLC: THE PITT': ['<a href="https://fallout.fandom.com/wiki/Into_The_Pitt" target="_blank">INTO THE PITT</a>', '<a href="https://fallout.fandom.com/wiki/Unsafe_Working_Conditions" target="_blank">UNSAFE WORKING CONDITIONS</a>', '<a href="https://fallout.fandom.com/wiki/Free_Labor" target="_blank">FREE LABOR</a>'],
            'DLC: POINT LOOKOUT': ['<a href="https://fallout.fandom.com/wiki/The_Local_Flavor" target="_blank">THE LOCAL FLAVOR</a>', '<a href="https://fallout.fandom.com/wiki/Walking_with_Spirits" target="_blank">WALKING WITH SPIRITS</a>', '<a href="https://fallout.fandom.com/wiki/Hearing_Voices" target="_blank">HEARING VOICES</a>', '<a href="https://fallout.fandom.com/wiki/Thought_Control" target="_blank">THOUGHT CONTROL</a>', '<a href="https://fallout.fandom.com/wiki/A_Meeting_of_the_Minds" target="_blank">A MEETING OF THE MINDS</a>', '<a href="https://fallout.fandom.com/wiki/The_Velvet_Curtain" target="_blank">THE VELVET CURTAIN</a>', '<a href="https://fallout.fandom.com/wiki/An_Ancient_Heritage" target="_blank">AN ANCIENT HERITAGE</a>', '<a href="https://fallout.fandom.com/wiki/Plik%27s_Safari" target="_blank">PLIK\'S SAFARI</a>'],
            'DLC: MOTHERSHIP ZETA': ['<a href="https://fallout.fandom.com/wiki/Not_of_This_World_(quest)" target="_blank">NOT OF THIS WORLD</a>', '<a href="https://fallout.fandom.com/wiki/Among_the_Stars" target="_blank">AMONG THE STARS</a>', '<a href="https://fallout.fandom.com/wiki/This_Galaxy_Ain%27t_Big_Enough..." target="_blank">THIS GALAXY AIN\'T BIG ENOUGH...</a>']
        },
        'MW': { 
            'MAIN QUEST (GENERAL)': ['<a href="https://fallout.fandom.com/wiki/Ain%27t_That_a_Kick_in_the_Head_(quest)" target="_blank">AIN\'T THAT A KICK IN THE HEAD</a>', '<a href="https://fallout.fandom.com/wiki/Back_in_the_Saddle" target="_blank">BACK IN THE SADDLE</a>', '<a href="https://fallout.fandom.com/wiki/By_a_Campfire_on_the_Trail" target="_blank">BY A CAMPFIRE ON THE TRAIL</a>', '<a href="https://fallout.fandom.com/wiki/They_Went_That-a-Way" target="_blank">THEY WENT THAT-A-WAY</a>', '<a href="https://fallout.fandom.com/wiki/Ring-a-Ding-Ding!" target="_blank">RING-A-DING-DING!</a>'],
            'MAIN QUEST (INDEPENDENT)': ['<a href="https://fallout.fandom.com/wiki/Wild_Card:_Ace_in_the_Hole" target="_blank">WILD CARD: ACE IN THE HOLE</a>', '<a href="https://fallout.fandom.com/wiki/Wild_Card:_Change_in_Management" target="_blank">WILD CARD: CHANGE IN MANAGEMENT</a>', '<a href="https://fallout.fandom.com/wiki/Wild_Card:_You_and_What_Army%3F" target="_blank">WILD CARD: YOU AND WHAT ARMY?</a>', '<a href="https://fallout.fandom.com/wiki/Wild_Card:_Side_Bets" target="_blank">WILD CARD: SIDE BETS</a>', '<a href="https://fallout.fandom.com/wiki/Wild_Card:_Finishing_Touches" target="_blank">WILD CARD: FINISHING TOUCHES</a>', '<a href="https://fallout.fandom.com/wiki/No_Gods,_No_Masters" target="_blank">NO GODS, NO MASTERS</a>'],
            'MAIN QUEST (MR. HOUSE)': ['<a href="https://fallout.fandom.com/wiki/The_House_Always_Wins_I" target="_blank">THE HOUSE ALWAYS WINS I</a>', '<a href="https://fallout.fandom.com/wiki/The_House_Always_Wins_II" target="_blank">THE HOUSE ALWAYS WINS II</a>', '<a href="https://fallout.fandom.com/wiki/The_House_Always_Wins_III" target="_blank">THE HOUSE ALWAYS WINS III</a>', '<a href="https://fallout.fandom.com/wiki/The_House_Always_Wins_IV" target="_blank">THE HOUSE ALWAYS WINS IV</a>', '<a href="https://fallout.fandom.com/wiki/The_House_Always_Wins_V" target="_blank">THE HOUSE ALWAYS WINS V</a>', '<a href="https://fallout.fandom.com/wiki/The_House_Always_Wins_VI" target="_blank">THE HOUSE ALWAYS WINS VI</a>', '<a href="https://fallout.fandom.com/wiki/The_House_Always_Wins_VII" target="_blank">THE HOUSE ALWAYS WINS VII</a>', '<a href="https://fallout.fandom.com/wiki/The_House_Always_Wins_VIII" target="_blank">THE HOUSE ALWAYS WINS VIII</a>', '<a href="https://fallout.fandom.com/wiki/All_or_Nothing" target="_blank">ALL OR NOTHING</a>'],
            'MAIN QUEST (NCR)': ['<a href="https://fallout.fandom.com/wiki/Things_That_Go_Boom" target="_blank">THINGS THAT GO BOOM</a>', '<a href="https://fallout.fandom.com/wiki/Kings%27_Gambit" target="_blank">KINGS\' GAMBIT</a>', '<a href="https://fallout.fandom.com/wiki/For_the_Republic,_Part_2" target="_blank">FOR THE REPUBLIC, PART 2</a>', '<a href="https://fallout.fandom.com/wiki/You%27ll_Know_It_When_It_Happens" target="_blank">YOU\'LL KNOW IT WHEN IT HAPPENS</a>', '<a href="https://fallout.fandom.com/wiki/Eureka!" target="_blank">EUREKA!</a>'],
            'MAIN QUEST (LEGION)': ['<a href="https://fallout.fandom.com/wiki/Render_Unto_Caesar" target="_blank">RENDER UNTO CAESAR</a>', '<a href="https://fallout.fandom.com/wiki/Et_Tumor,_Brute%3F" target="_blank">ET TUMOR, BRUTE?</a>', '<a href="https://fallout.fandom.com/wiki/Arizona_Killer" target="_blank">ARIZONA KILLER</a>', '<a href="https://fallout.fandom.com/wiki/Veni,_Vidi,_Vici" target="_blank">VENI, VIDI, VICI</a>'],
            'SIDE QUESTS (MOJAVE)': ['<a href="https://fallout.fandom.com/wiki/A_Valuable_Lesson" target="_blank">A VALUABLE LESSON</a>', '<a href="https://fallout.fandom.com/wiki/Aba_Daba_Honeymoon" target="_blank">ABA DABA HONEYMOON</a>', '<a href="https://fallout.fandom.com/wiki/Ant_Misbehavin%27" target="_blank">ANT MISBEHAVIN\'</a>', '<a href="https://fallout.fandom.com/wiki/Anywhere_I_Wander" target="_blank">ANYWHERE I WANDER</a>', '<a href="https://fallout.fandom.com/wiki/Back_in_Your_Own_Backyard" target="_blank">BACK IN YOUR OWN BACKYARD</a>', '<a href="https://fallout.fandom.com/wiki/Beyond_the_Beef" target="_blank">BEYOND THE BEEF</a>', '<a href="https://fallout.fandom.com/wiki/Birds_of_a_Feather" target="_blank">BIRDS OF A FEATHER</a>', '<a href="https://fallout.fandom.com/wiki/Bitter_Springs_Infirmary_Blues" target="_blank">BITTER SPRINGS INFIRMARY BLUES</a>', '<a href="https://fallout.fandom.com/wiki/Booted" target="_blank">BOOTED</a>', '<a href="https://fallout.fandom.com/wiki/Boulder_City_Showdown" target="_blank">BOULDER CITY SHOWDOWN</a>', '<a href="https://fallout.fandom.com/wiki/Bye_Bye_Love" target="_blank">BYE BYE LOVE</a>', '<a href="https://fallout.fandom.com/wiki/Can_You_Find_it_in_Your_Heart%3F" target="_blank">CAN YOU FIND IT IN YOUR HEART?</a>', '<a href="https://fallout.fandom.com/wiki/Classic_Inspiration" target="_blank">CLASSIC INSPIRATION</a>', '<a href="https://fallout.fandom.com/wiki/Climb_Ev%27ry_Mountain" target="_blank">CLIMB EV\'RY MOUNTAIN</a>', '<a href="https://fallout.fandom.com/wiki/Come_Fly_With_Me" target="_blank">COME FLY WITH ME</a>', '<a href="https://fallout.fandom.com/wiki/Crazy,_Crazy,_Crazy" target="_blank">CRAZY, CRAZY, CRAZY</a>', '<a href="https://fallout.fandom.com/wiki/Cry_Me_a_River" target="_blank">CRY ME A RIVER</a>', '<a href="https://fallout.fandom.com/wiki/Debt_Collector" target="_blank">DEBT COLLECTOR</a>', '<a href="https://fallout.fandom.com/wiki/Don%27t_Make_a_Beggar_of_Me" target="_blank">DON\'T MAKE A BEGGAR OF ME</a>', '<a href="https://fallout.fandom.com/wiki/Eye_for_an_Eye" target="_blank">EYE FOR AN EYE</a>', '<a href="https://fallout.fandom.com/wiki/Eyesight_to_the_Blind" target="_blank">EYESIGHT TO THE BLIND</a>', '<a href="https://fallout.fandom.com/wiki/Flag_of_Our_Foul-Ups" target="_blank">FLAG OF OUR FOUL-UPS</a>', '<a href="https://fallout.fandom.com/wiki/G.I._Blues" target="_blank">G.I. BLUES</a>', '<a href="https://fallout.fandom.com/wiki/Ghost_Town_Gunfight" target="_blank">GHOST TOWN GUNFIGHT</a>', '<a href="https://fallout.fandom.com/wiki/Guess_Who_I_Saw_Today" target="_blank">GUESS WHO I SAW TODAY</a>', '<a href="https://fallout.fandom.com/wiki/Hard_Luck_Blues" target="_blank">HARD LUCK BLUES</a>', '<a href="https://fallout.fandom.com/wiki/High_Times" target="_blank">HIGH TIMES</a>', '<a href="https://fallout.fandom.com/wiki/How_Little_We_Know" target="_blank">HOW LITTLE WE KNOW</a>', '<a href="https://fallout.fandom.com/wiki/I_Don%27t_Hurt_Anymore" target="_blank">I DON\'T HURT ANYMORE</a>', '<a href="https://fallout.fandom.com/wiki/I_Put_a_Spell_on_You" target="_blank">I PUT A SPELL ON YOU</a>', '<a href="https://fallout.fandom.com/wiki/Keep_Your_Eyes_on_the_Prize" target="_blank">KEEP YOUR EYES ON THE PRIZE</a>', '<a href="https://fallout.fandom.com/wiki/Left_My_Heart" target="_blank">LEFT MY HEART</a>', '<a href="https://fallout.fandom.com/wiki/Medical_Mystery" target="_blank">MEDICAL MYSTERY</a>', '<a href="https://fallout.fandom.com/wiki/My_Kind_of_Town" target="_blank">MY KIND OF TOWN</a>', '<a href="https://fallout.fandom.com/wiki/No,_Not_Much" target="_blank">NO, NOT MUCH</a>', '<a href="https://fallout.fandom.com/wiki/Oh_My_Papa" target="_blank">OH MY PAPA</a>', '<a href="https://fallout.fandom.com/wiki/One_for_My_Baby" target="_blank">ONE FOR MY BABY</a>', '<a href="https://fallout.fandom.com/wiki/Pheeble_Will" target="_blank">PHEEBLE WILL</a>', '<a href="https://fallout.fandom.com/wiki/Pressing_Matters" target="_blank">PRESSING MATTERS</a>', '<a href="https://fallout.fandom.com/wiki/Restoring_Hope" target="_blank">RESTORING HOPE</a>', '<a href="https://fallout.fandom.com/wiki/Return_to_Sender" target="_blank">RETURN TO SENDER</a>', '<a href="https://fallout.fandom.com/wiki/Someone_to_Watch_Over_Me" target="_blank">SOMEONE TO WATCH OVER ME</a>', '<a href="https://fallout.fandom.com/wiki/Still_in_the_Dark" target="_blank">STILL IN THE DARK</a>', '<a href="https://fallout.fandom.com/wiki/Sunshine_Boogie" target="_blank">SUNSHINE BOOGIE</a>', '<a href="https://fallout.fandom.com/wiki/Talent_Pool" target="_blank">TALENT POOL</a>', '<a href="https://fallout.fandom.com/wiki/That_Lucky_Old_Sun" target="_blank">THAT LUCKY OLD SUN</a>', '<a href="https://fallout.fandom.com/wiki/The_Coyotes" target="_blank">THE COYOTES</a>', '<a href="https://fallout.fandom.com/wiki/The_Legend_of_the_Star" target="_blank">THE LEGEND OF THE STAR</a>', '<a href="https://fallout.fandom.com/wiki/The_Moon_Comes_Over_the_Tower" target="_blank">THE MOON COMES OVER THE TOWER</a>', '<a href="https://fallout.fandom.com/wiki/The_White_Wash" target="_blank">THE WHITE WASH</a>', '<a href="https://fallout.fandom.com/wiki/There_Stands_the_Grass" target="_blank">THERE STANDS THE GRASS</a>', '<a href="https://fallout.fandom.com/wiki/Three-Card_Bounty" target="_blank">THREE-CARD BOUNTY</a>', '<a href="https://fallout.fandom.com/wiki/Unfriendly_Persuasion" target="_blank">UNFRIENDLY PERSUASION</a>', '<a href="https://fallout.fandom.com/wiki/Volare!" target="_blank">VOLARE!</a>', '<a href="https://fallout.fandom.com/wiki/Wang_Dang_Atomic_Tango" target="_blank">WANG DANG ATOMIC TANGO</a>', '<a href="https://fallout.fandom.com/wiki/We_Will_All_Go_Together" target="_blank">WE WILL ALL GO TOGETHER</a>', '<a href="https://fallout.fandom.com/wiki/Wheel_of_Fortune" target="_blank">WHEEL OF FORTUNE</a>', '<a href="https://fallout.fandom.com/wiki/Why_Can%27t_We_Be_Friends%3F" target="_blank">WHY CAN\'T WE BE FRIENDS?</a>', '<a href="https://fallout.fandom.com/wiki/You_Can_Depend_on_Me" target="_blank">YOU CAN DEPEND ON ME</a>', '<a href="https://fallout.fandom.com/wiki/Young_Hearts" target="_blank">YOUNG HEARTS</a>'],
            'DLC: DEAD MONEY': ['<a href="https://fallout.fandom.com/wiki/Sierra_Madre_Grand_Opening!" target="_blank">SIERRA MADRE GRAND OPENING!</a>', '<a href="https://fallout.fandom.com/wiki/Find_Collar_8:_Dog" target="_blank">FIND COLLAR 8: DOG</a>', '<a href="https://fallout.fandom.com/wiki/Find_Collar_12:_Christine" target="_blank">FIND COLLAR 12: CHRISTINE</a>', '<a href="https://fallout.fandom.com/wiki/Find_Collar_14:_Dean_Domino" target="_blank">FIND COLLAR 14: DEAN DOMINO</a>', '<a href="https://fallout.fandom.com/wiki/Fires_in_the_Sky" target="_blank">FIRES IN THE SKY</a>', '<a href="https://fallout.fandom.com/wiki/Strike_Up_the_Band" target="_blank">STRIKE UP THE BAND</a>', '<a href="https://fallout.fandom.com/wiki/Trigger_the_Gala_Event" target="_blank">TRIGGER THE GALA EVENT</a>', '<a href="https://fallout.fandom.com/wiki/Curtain_Call_at_the_Tampico" target="_blank">CURTAIN CALL AT THE TAMPICO</a>', '<a href="https://fallout.fandom.com/wiki/Last_Luxuries" target="_blank">LAST LUXURIES</a>', '<a href="https://fallout.fandom.com/wiki/Heist_of_the_Centuries" target="_blank">HEIST OF THE CENTURIES</a>', '<a href="https://fallout.fandom.com/wiki/Departing_Paradise" target="_blank">DEPARTING PARADISE</a>'],
            'DLC: HONEST HEARTS': ['<a href="https://fallout.fandom.com/wiki/Happy_Trails_Expedition" target="_blank">HAPPY TRAILS EXPEDITION</a>', '<a href="https://fallout.fandom.com/wiki/Arrival_at_Zion" target="_blank">ARRIVAL AT ZION</a>', '<a href="https://fallout.fandom.com/wiki/Roadside_Attraction" target="_blank">ROADSIDE ATTRACTION</a>', '<a href="https://fallout.fandom.com/wiki/Gone_Fishin%27" target="_blank">GONE FISHIN\'</a>', '<a href="https://fallout.fandom.com/wiki/Tourist_Trap" target="_blank">TOURIST TRAP</a>', '<a href="https://fallout.fandom.com/wiki/Deliverer_of_Sorrows" target="_blank">DELIVERER OF SORROWS</a>', '<a href="https://fallout.fandom.com/wiki/The_Grand_Staircase" target="_blank">THE GRAND STAIRCASE</a>', '<a href="https://fallout.fandom.com/wiki/The_Advance_Scouts" target="_blank">THE ADVANCE SCOUTS</a>', '<a href="https://fallout.fandom.com/wiki/The_Treacherous_Road" target="_blank">THE TREACHEROUS ROAD</a>', '<a href="https://fallout.fandom.com/wiki/River_Monsters" target="_blank">RIVER MONSTERS</a>', '<a href="https://fallout.fandom.com/wiki/Gathering_Storms" target="_blank">GATHERING STORMS</a>', '<a href="https://fallout.fandom.com/wiki/Crush_the_White_Legs" target="_blank">CRUSH THE WHITE LEGS</a>'],
            'DLC: OLD WORLD BLUES': ['<a href="https://fallout.fandom.com/wiki/Midnight_Science_Fiction_Feature!" target="_blank">MIDNIGHT SCIENCE FICTION FEATURE!</a>', '<a href="https://fallout.fandom.com/wiki/Welcome_to_the_Big_Empty" target="_blank">WELCOME TO THE BIG EMPTY</a>', '<a href="https://fallout.fandom.com/wiki/All_My_Friends_Have_Off_Switches" target="_blank">ALL MY FRIENDS HAVE OFF SWITCHES</a>', '<a href="https://fallout.fandom.com/wiki/X-2:_Strange_Transmissions!" target="_blank">X-2: STRANGE TRANSMISSIONS!</a>', '<a href="https://fallout.fandom.com/wiki/X-8:_High_School_Horror!" target="_blank">X-8: HIGH SCHOOL HORROR!</a>', '<a href="https://fallout.fandom.com/wiki/X-13:_Attack_of_the_Infiltrator!" target="_blank">X-13: ATTACK OF THE INFILTRATOR!</a>', '<a href="https://fallout.fandom.com/wiki/Old_World_Blues_(quest)" target="_blank">OLD WORLD BLUES</a>', '<a href="https://fallout.fandom.com/wiki/Project_X-13" target="_blank">PROJECT X-13</a>'],
            'DLC: LONESOME ROAD': ['<a href="https://fallout.fandom.com/wiki/The_Reunion" target="_blank">THE REUNION</a>', '<a href="https://fallout.fandom.com/wiki/The_Silo" target="_blank">THE SILO</a>', '<a href="https://fallout.fandom.com/wiki/The_Job" target="_blank">THE JOB</a>', '<a href="https://fallout.fandom.com/wiki/The_Launch" target="_blank">THE LAUNCH</a>', '<a href="https://fallout.fandom.com/wiki/The_Divide" target="_blank">THE DIVIDE</a>', '<a href="https://fallout.fandom.com/wiki/The_Tunnelers" target="_blank">THE TUNNELERS</a>', '<a href="https://fallout.fandom.com/wiki/The_Courier" target="_blank">THE COURIER</a>', '<a href="https://fallout.fandom.com/wiki/The_End_(quest)" target="_blank">THE END</a>', '<a href="https://fallout.fandom.com/wiki/The_Apocalypse" target="_blank">THE APOCALYPSE</a>']
        }
    };

    const uniqueWeaponData = {
        "PISTOLS & REVOLVERS": ["<a href='https://fallout.fandom.com/wiki/A_Light_Shining_in_Darkness' target='_blank'>A LIGHT SHINING IN DARKNESS</a>", "<a href='https://fallout.fandom.com/wiki/Blackhawk' target='_blank'>BLACKHAWK</a>", "<a href='https://fallout.fandom.com/wiki/Callahan%27s_magnum' target='_blank'>CALLAHAN'S MAGNUM</a>", "<a href='https://fallout.fandom.com/wiki/Colonel_Autumn%27s_10mm_pistol' target='_blank'>COLONEL AUTUMN'S 10MM PISTOL</a>", "<a href='https://fallout.fandom.com/wiki/Li%27l_Devil' target='_blank'>LI'L DEVIL</a>", "<a href='https://fallout.fandom.com/wiki/Lucky' target='_blank'>LUCKY</a>", "<a href='https://fallout.fandom.com/wiki/Maria' target='_blank'>MARIA</a>", "<a href='https://fallout.fandom.com/wiki/Mysterious_Magnum' target='_blank'>MYSTERIOUS MAGNUM</a>", "<a href='https://fallout.fandom.com/wiki/Paulson%27s_revolver' target='_blank'>PAULSON'S REVOLVER</a>", "<a href='https://fallout.fandom.com/wiki/Ranger_Sequoia' target='_blank'>RANGER SEQUOIA</a>", "<a href='https://fallout.fandom.com/wiki/That_Gun' target='_blank'>THAT GUN</a>", "<a href='https://fallout.fandom.com/wiki/Weathered_10mm_pistol' target='_blank'>WEATHERED 10MM PISTOL</a>", "<a href='https://fallout.fandom.com/wiki/Wild_Bill%27s_Sidearm' target='_blank'>WILD BILL'S SIDEARM</a>", "<a href='https://fallout.fandom.com/wiki/Zhu-Rong_v418_Chinese_pistol' target='_blank'>ZHU-RONG V418 CHINESE PISTOL</a>"],
        "SMGS & RIFLES": ["<a href='https://fallout.fandom.com/wiki/Abilene_Kid_LE_BB_gun' target='_blank'>ABILENE KID LE BB GUN</a>", "<a href='https://fallout.fandom.com/wiki/All-American' target='_blank'>ALL-AMERICAN</a>", "<a href='https://fallout.fandom.com/wiki/Backwater_rifle' target='_blank'>BACKWATER RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Christine%27s_CoS_silencer_rifle' target='_blank'>CHRISTINE'S COS SILENCER RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Gobi_Campaign_scout_rifle' target='_blank'>GOBI CAMPAIGN SCOUT RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Infiltrator' target='_blank'>INFILTRATOR</a>", "<a href='https://fallout.fandom.com/wiki/La_Longue_Carabine' target='_blank'>LA LONGUE CARABINE</a>", "<a href='https://fallout.fandom.com/wiki/Lincoln%27s_repeater' target='_blank'>LINCOLN'S REPEATER</a>", "<a href='https://fallout.fandom.com/wiki/Medicine_Stick' target='_blank'>MEDICINE STICK</a>", "<a href='https://fallout.fandom.com/wiki/Ol%27_Painless' target='_blank'>OL' PAINLESS</a>", "<a href='https://fallout.fandom.com/wiki/Paciencia' target='_blank'>PACIENCIA</a>", "<a href='https://fallout.fandom.com/wiki/Perforator' target='_blank'>PERFORATOR</a>", "<a href='https://fallout.fandom.com/wiki/Ratslayer' target='_blank'>RATSLAYER</a>", "<a href='https://fallout.fandom.com/wiki/Reservist%27s_rifle' target='_blank'>RESERVIST'S RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Sleepytyme' target='_blank'>SLEEPYTYME</a>", "<a href='https://fallout.fandom.com/wiki/Survivalist%27s_rifle' target='_blank'>SURVIVALIST'S RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Sydney%27s_10mm_%22Ultra%22_SMG' target='_blank'>SYDNEY'S 10MM \"ULTRA\" SMG</a>", "<a href='https://fallout.fandom.com/wiki/This_Machine' target='_blank'>THIS MACHINE</a>", "<a href='https://fallout.fandom.com/wiki/Vance%27s_9mm_SMG' target='_blank'>VANCE'S 9MM SMG</a>", "<a href='https://fallout.fandom.com/wiki/Victory_rifle' target='_blank'>VICTORY RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Xuanlong_assault_rifle' target='_blank'>XUANLONG ASSAULT RIFLE</a>"],
        "SHOTGUNS": ["<a href='https://fallout.fandom.com/wiki/Big_Boomer' target='_blank'>BIG BOOMER</a>", "<a href='https://fallout.fandom.com/wiki/Dinner_Bell' target='_blank'>DINNER BELL</a>", "<a href='https://fallout.fandom.com/wiki/Sturdy_caravan_shotgun' target='_blank'>STURDY CARAVAN SHOTGUN</a>", "<a href='https://fallout.fandom.com/wiki/The_Kneecapper' target='_blank'>THE KNEECAPPER</a>", "<a href='https://fallout.fandom.com/wiki/The_Terrible_Shotgun' target='_blank'>THE TERRIBLE SHOTGUN</a>"],
        "BIG GUNS": ["<a href='https://fallout.fandom.com/wiki/Bozar_(Fallout:_New_Vegas)' target='_blank'>BOZAR</a>", "<a href='https://fallout.fandom.com/wiki/Burnmaster' target='_blank'>BURNMASTER</a>", "<a href='https://fallout.fandom.com/wiki/CZ57_Avenger' target='_blank'>CZ57 AVENGER</a>", "<a href='https://fallout.fandom.com/wiki/Drone_cannon_Ex-B' target='_blank'>DRONE CANNON EX-B</a>", "<a href='https://fallout.fandom.com/wiki/Eugene' target='_blank'>EUGENE</a>", "<a href='https://fallout.fandom.com/wiki/Experimental_MIRV' target='_blank'>EXPERIMENTAL MIRV</a>", "<a href='https://fallout.fandom.com/wiki/Precision_Gatling_laser' target='_blank'>PRECISION GATLING LASER</a>", "<a href='https://fallout.fandom.com/wiki/Rapid-torch_flamer' target='_blank'>RAPID-TORCH FLAMER</a>", "<a href='https://fallout.fandom.com/wiki/Slo-burn_flamer' target='_blank'>SLO-BURN FLAMER</a>", "<a href='https://fallout.fandom.com/wiki/Vengeance' target='_blank'>VENGEANCE</a>"],
        "ENERGY WEAPONS": ["<a href='https://fallout.fandom.com/wiki/A3-21%27s_plasma_rifle' target='_blank'>A3-21'S PLASMA RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/AER14_prototype' target='_blank'>AER14 PROTOTYPE</a>", "<a href='https://fallout.fandom.com/wiki/Alien_blaster_(Fallout_3)' target='_blank'>ALIEN BLASTER</a>", "<a href='https://fallout.fandom.com/wiki/Atomic_pulverizer' target='_blank'>ATOMIC PULVERIZER</a>", "<a href='https://fallout.fandom.com/wiki/Captain%27s_sidearm' target='_blank'>CAPTAIN'S SIDEARM</a>", "<a href='https://fallout.fandom.com/wiki/Cleansing_Flame' target='_blank'>CLEANSING FLAME</a>", "<a href='https://fallout.fandom.com/wiki/Colonel_Autumn%27s_laser_pistol' target='_blank'>COLONEL AUTUMN'S LASER PISTOL</a>", "<a href='https://fallout.fandom.com/wiki/Compliance_Regulator' target='_blank'>COMPLIANCE REGULATOR</a>", "<a href='https://fallout.fandom.com/wiki/Destabilizer' target='_blank'>DESTABILIZER</a>", "<a href='https://fallout.fandom.com/wiki/Elijah%27s_advanced_LAER' target='_blank'>ELIJAH'S ADVANCED LAER</a>", "<a href='https://fallout.fandom.com/wiki/Elijah%27s_jury-rigged_Tesla_cannon' target='_blank'>ELIJAH'S JURY-RIGGED TESLA CANNON</a>", "<a href='https://fallout.fandom.com/wiki/Euclid%27s_C-Finder' target='_blank'>EUCLID'S C-FINDER</a>", "<a href='https://fallout.fandom.com/wiki/Firelance' target='_blank'>FIRELANCE</a>", "<a href='https://fallout.fandom.com/wiki/Gauss_rifle_(Fallout_3)' target='_blank'>GAUSS RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Holorifle' target='_blank'>HOLORIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Mesmetron' target='_blank'>MESMETRON</a>", "<a href='https://fallout.fandom.com/wiki/Metal_Blaster' target='_blank'>METAL BLASTER</a>", "<a href='https://fallout.fandom.com/wiki/MF_Hyperbreeder_Alpha' target='_blank'>MF HYPERBREEDER ALPHA</a>", "<a href='https://fallout.fandom.com/wiki/Microwave_emitter' target='_blank'>MICROWAVE EMITTER</a>", "<a href='https://fallout.fandom.com/wiki/Missing_laser_pistol' target='_blank'>MISSING LASER PISTOL</a>", "<a href='https://fallout.fandom.com/wiki/MPLX_Novasurge' target='_blank'>MPLX NOVASURGE</a>", "<a href='https://fallout.fandom.com/wiki/Pew_Pew' target='_blank'>PEW PEW</a>", "<a href='https://fallout.fandom.com/wiki/Protectron%27s_Gaze' target='_blank'>PROTECTRON'S GAZE</a>", "<a href='https://fallout.fandom.com/wiki/Pulse_gun' target='_blank'>PULSE GUN</a>", "<a href='https://fallout.fandom.com/wiki/Q-35_matter_modulator' target='_blank'>Q-35 MATTER MODULATOR</a>", "<a href='https://fallout.fandom.com/wiki/Smuggler%27s_End' target='_blank'>SMUGGLER'S END</a>", "<a href='https://fallout.fandom.com/wiki/Sprtel-Wood_9700' target='_blank'>SPRTEL-WOOD 9700</a>", "<a href='https://fallout.fandom.com/wiki/Tesla-Beaton_prototype' target='_blank'>TESLA-BEATON PROTOTYPE</a>", "<a href='https://fallout.fandom.com/wiki/The_Smitty_Special' target='_blank'>THE SMITTY SPECIAL</a>", "<a href='https://fallout.fandom.com/wiki/Wazer_Wifle' target='_blank'>WAZER WIFLE</a>", "<a href='https://fallout.fandom.com/wiki/YCS/186' target='_blank'>YCS/186</a>"],
        "EXPLOSIVES": ["<a href='https://fallout.fandom.com/wiki/Annabelle' target='_blank'>ANNABELLE</a>", "<a href='https://fallout.fandom.com/wiki/Esther' target='_blank'>ESTHER</a>", "<a href='https://fallout.fandom.com/wiki/Great_Bear_grenade_rifle' target='_blank'>GREAT BEAR GRENADE RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Holy_Frag_Grenade' target='_blank'>HOLY FRAG GRENADE</a>", "<a href='https://fallout.fandom.com/wiki/Mercenary%27s_grenade_rifle' target='_blank'>MERCENARY'S GRENADE RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Mercy' target='_blank'>MERCY</a>", "<a href='https://fallout.fandom.com/wiki/Miss_Launcher' target='_blank'>MISS LAUNCHER</a>", "<a href='https://fallout.fandom.com/wiki/Red_Victory_grenade_rifle' target='_blank'>RED VICTORY GRENADE RIFLE</a>", "<a href='https://fallout.fandom.com/wiki/Thump-Thump' target='_blank'>THUMP-THUMP</a>"],
        "MELEE WEAPONS": ["<a href='https://fallout.fandom.com/wiki/Ant%27s_Sting' target='_blank'>ANT'S STING</a>", "<a href='https://fallout.fandom.com/wiki/Blade_of_the_East' target='_blank'>BLADE OF THE EAST</a>", "<a href='https://fallout.fandom.com/wiki/Blood-Nap' target='_blank'>BLOOD-NAP</a>", "<a href='https://fallout.fandom.com/wiki/Board_of_Education' target='_blank'>BOARD OF EDUCATION</a>", "<a href='https://fallout.fandom.com/wiki/Broad_machete' target='_blank'>BROAD MACHETE</a>", "<a href='https://fallout.fandom.com/wiki/Butch%27s_Toothpick' target='_blank'>BUTCH'S TOOTHPICK</a>", "<a href='https://fallout.fandom.com/wiki/Chance%27s_knife' target='_blank'>CHANCE'S KNIFE</a>", "<a href='https://fallout.fandom.com/wiki/Chopper' target='_blank'>CHOPPER</a>", "<a href='https://fallout.fandom.com/wiki/Electro-Suppressor' target='_blank'>ELECTRO-SUPPRESSOR</a>", "<a href='https://fallout.fandom.com/wiki/Fawkes%27_super_sledge' target='_blank'>FAWKES' SUPER SLEDGE</a>", "<a href='https://fallout.fandom.com/wiki/Fertilizer_shovel' target='_blank'>FERTILIZER SHOVEL</a>", "<a href='https://fallout.fandom.com/wiki/Figaro' target='_blank'>FIGARO</a>", "<a href='https://fallout.fandom.com/wiki/Gehenna' target='_blank'>GEHENNA</a>", "<a href='https://fallout.fandom.com/wiki/Highwayman%27s_Friend' target='_blank'>HIGHWAYMAN'S FRIEND</a>", "<a href='https://fallout.fandom.com/wiki/Jack_(Fallout_3)' target='_blank'>JACK</a>", "<a href='https://fallout.fandom.com/wiki/Jingwei%27s_shock_sword' target='_blank'>JINGWEI'S SHOCKSWORD</a>", "<a href='https://fallout.fandom.com/wiki/Knock-Knock' target='_blank'>KNOCK-KNOCK</a>", "<a href='https://fallout.fandom.com/wiki/Liberator' target='_blank'>LIBERATOR</a>", "<a href='https://fallout.fandom.com/wiki/Man_Opener' target='_blank'>MAN OPENER</a>", "<a href='https://fallout.fandom.com/wiki/Nephi%27s_golf_driver' target='_blank'>NEPHI'S GOLF DRIVER</a>", "<a href='https://fallout.fandom.com/wiki/Nuka-Breaker' target='_blank'>NUKA-BREAKER</a>", "<a href='https://fallout.fandom.com/wiki/Occam%27s_Razor' target='_blank'>OCCAM'S RAZOR</a>", "<a href='https://fallout.fandom.com/wiki/Oh,_Baby!' target='_blank'>OH, BABY!</a>", "<a href='https://fallout.fandom.com/wiki/Old_Glory' target='_blank'>OLD GLORY</a>", "<a href='https://fallout.fandom.com/wiki/Repellent_stick' target='_blank'>REPELLENT STICK</a>", "<a href='https://fallout.fandom.com/wiki/Ritual_knife' target='_blank'>RITUAL KNIFE</a>", "<a href='https://fallout.fandom.com/wiki/Samurai%27s_sword' target='_blank'>SAMURAI'S SWORD</a>", "<a href='https://fallout.fandom.com/wiki/Stabhappy' target='_blank'>STABHAPPY</a>", "<a href='https://fallout.fandom.com/wiki/The_Break' target='_blank'>THE BREAK</a>", "<a href='https://fallout.fandom.com/wiki/The_Dismemberer' target='_blank'>THE DISMEMBERER</a>", "<a href='https://fallout.fandom.com/wiki/The_Humble_Cudgel' target='_blank'>THE HUMBLE CUDGEL</a>", "<a href='https://fallout.fandom.com/wiki/The_Mauler' target='_blank'>THE MAULER</a>", "<a href='https://fallout.fandom.com/wiki/The_Tenderizer' target='_blank'>THE TENDERIZER</a>", "<a href='https://fallout.fandom.com/wiki/Toy_knife' target='_blank'>TOY KNIFE</a>", "<a href='https://fallout.fandom.com/wiki/Trench_knife' target='_blank'>TRENCH KNIFE</a>", "<a href='https://fallout.fandom.com/wiki/Vampire%27s_Edge' target='_blank'>VAMPIRE'S EDGE</a>", "<a href='https://fallout.fandom.com/wiki/X-2_antenna' target='_blank'>X-2 ANTENNA</a>"],
        "UNARMED": ["<a href='https://fallout.fandom.com/wiki/Cram_Opener' target='_blank'>CRAM OPENER</a>", "<a href='https://fallout.fandom.com/wiki/Dr._Klein%27s_glove' target='_blank'>DR. KLEIN'S GLOVE</a>", "<a href='https://fallout.fandom.com/wiki/Dr._Mobius%27_glove' target='_blank'>DR. MOBIUS' GLOVE</a>", "<a href='https://fallout.fandom.com/wiki/Embrace_of_the_Mantis_King!' target='_blank'>EMBRACE OF THE MANTIS KING!</a>", "<a href='https://fallout.fandom.com/wiki/Fist_of_Rawr' target='_blank'>FIST OF RAWR</a>", "<a href='https://fallout.fandom.com/wiki/Fisto!' target='_blank'>FISTO!</a>", "<a href='https://fallout.fandom.com/wiki/Golden_Gloves' target='_blank'>GOLDEN GLOVES</a>", "<a href='https://fallout.fandom.com/wiki/Greased_Lightning_(Gun_Runners%27_Arsenal)' target='_blank'>GREASED LIGHTNING</a>", "<a href='https://fallout.fandom.com/wiki/Love_and_Hate' target='_blank'>LOVE AND HATE</a>", "<a href='https://fallout.fandom.com/wiki/Paladin_Toaster' target='_blank'>PALADIN TOASTER</a>", "<a href='https://fallout.fandom.com/wiki/Plunkett%27s_Valid_Points' target='_blank'>PLUNKETT'S VALID POINTS</a>", "<a href='https://fallout.fandom.com/wiki/Pushy' target='_blank'>PUSHY</a>", "<a href='https://fallout.fandom.com/wiki/Recompense_of_the_Fallen' target='_blank'>RECOMPENSE OF THE FALLEN</a>", "<a href='https://fallout.fandom.com/wiki/Salt-Upon-Wounds%27_power_fist' target='_blank'>SALT-UPON-WOUNDS' POWER FIST</a>", "<a href='https://fallout.fandom.com/wiki/She%27s_Embrace' target='_blank'>SHE'S EMBRACE</a>", "<a href='https://fallout.fandom.com/wiki/The_Shocker' target='_blank'>THE SHOCKER</a>", "<a href='https://fallout.fandom.com/wiki/Two-Step_Goodbye' target='_blank'>TWO-STEP GOODBYE</a>"]
    };

    /* --- TAB CONTROLLER --- */
    function showTab(t) { 
        document.querySelectorAll('.tab-content').forEach(c => c.style.display='none'); 
        document.querySelectorAll('.tab-nav button').forEach(b => b.classList.remove('active')); 
        document.getElementById('tab-'+t).style.display='block'; 
        document.getElementById('tab-btn-'+t).classList.add('active'); 
    }

    /* --- MODE & ORIGIN TOGGLES --- */
    function setMode(m, skipSave=false) {
        mode = m; document.body.classList.toggle('mode-hc', m==='hc');
        document.getElementById('hc-banner').style.display = m==='hc' ? 'flex' : 'none';
        document.getElementById('sysop-note').style.display = m==='hc' ? 'block' : 'none';
        document.getElementById('m-std').classList.toggle('active', m==='std');
        document.getElementById('m-hc').classList.toggle('active', m==='hc');
        renderProgression(); updateAll();
        if(!skipSave) triggerAutosave();
    }

    function setOrigin(o, skipSave=false) {
        // SAVE CURRENT STATE BEFORE SWITCHING
        if (!skipSave) {
            regionalStorage[origin].quests = Array.from(document.querySelectorAll('#quest-list-container input')).map(i => i.checked);
            regionalStorage[origin].colls = Array.from(document.querySelectorAll('#coll-list input')).map(i => i.checked);
        }

        origin = o; 
        document.body.className = (o === 'MW') ? 'theme-mw' : 'theme-cw';
        if(mode==='hc') document.body.classList.add('mode-hc');
        document.getElementById('btn-cw').classList.toggle('active', o==='CW');
        document.getElementById('btn-mw').classList.toggle('active', o==='MW');
        
        // RENDER NEW ORIGIN UI
        renderQuests(); 
        renderCollectibles(); 
        
        // HYDRATE BOXES FROM STORAGE
        const qC = document.querySelectorAll('#quest-list-container input');
        regionalStorage[origin].quests.forEach((c, i) => { if(qC[i]) qC[i].checked = c; });
        const cC = document.querySelectorAll('#coll-list input');
        regionalStorage[origin].colls.forEach((c, i) => { if(cC[i]) cC[i].checked = c; });

        // CALCULATE COMPLETION FOR HEADERS
        document.querySelectorAll('.header-row').forEach(h => {
            const id = h.id.replace('h-', '');
            calcCat(id);
        });

        updateAll();
        if(!skipSave) triggerAutosave();
    }

    /* --- COLLAPSE LOGIC (NEW) --- */
    // Toggles the visibility of the grid below a clicked header row
    function toggleCollapse(id) {
        const grid = document.querySelector(`.grid-tidy[data-category="${id}"]`);
        if (grid) {
            grid.style.display = (grid.style.display === 'none') ? 'grid' : 'none';
        }
    }

    /* --- SEARCH LOGIC (NEW) --- */
    function searchItems(inputId, containerId) {
        const query = document.getElementById(inputId).value.toUpperCase();
        const items = document.querySelectorAll(`#${containerId} .grid-item`);
        
        items.forEach(item => {
            const text = item.innerText.toUpperCase();
            if (text.includes(query)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });

        // Manage headers visibility based on search results
        document.querySelectorAll(`#${containerId} .grid-tidy`).forEach(grid => {
            const visibleCount = Array.from(grid.querySelectorAll('.grid-item')).filter(i => i.style.display !== 'none').length;
            const categoryId = grid.getAttribute('data-category');
            const header = document.getElementById(`h-${categoryId}`);
            
            if (query !== "" && visibleCount > 0) {
                grid.style.display = 'grid'; // Expand automatically
                header.style.display = 'flex';
            } else if (query !== "" && visibleCount === 0) {
                grid.style.display = 'none';
                header.style.display = 'none';
            } else {
                // Reset to visible if search is cleared
                header.style.display = 'flex';
            }
        });
    }

    function searchQuests() { searchItems('quest-search-bar', 'quest-list-container'); }
    function searchUniques() { searchItems('uni-search-bar', 'unique-weapon-checklist'); }

    /* --- RENDER FUNCTIONS --- */
    function renderQuests() {
        const div = document.getElementById('quest-list-container'); div.innerHTML = '';
        for (const cat in questsData[origin]) {
            const safe = cat.replace(/[&\s]+/g, '-').toLowerCase().replace(':', '');
            // Click to toggle collapse
            let h = `<div class="header-row" id="h-${safe}" onclick="toggleCollapse('${safe}')"><h2>${cat}</h2><span class="cat-pct" id="pct-${safe}">0%</span></div><div class="grid-tidy" data-category="${safe}">`;
            questsData[origin][cat].forEach(q => { 
                // PERSISTENCE CHANGE: REPLACE 'INDY' WITH 'INDEPENDENT'
                const formattedQ = q.replace(/INDEPENDENT|INDY/gi, "INDEPENDENT");
                h += `<div class="grid-item"><input type="checkbox" onchange="calcCat('${safe}'); triggerAutosave();"><span>${formattedQ}</span></div>`; 
            });
            div.insertAdjacentHTML('beforeend', h + `</div>`);
        }
    }

    function renderUniques() {
        const div = document.getElementById('unique-weapon-checklist'); div.innerHTML = '';
        const categoryOrder = ["PISTOLS & REVOLVERS", "SMGS & RIFLES", "SHOTGUNS", "BIG GUNS", "ENERGY WEAPONS", "EXPLOSIVES", "MELEE WEAPONS", "UNARMED"];
        
        categoryOrder.forEach(cat => {
            if (uniqueWeaponData[cat]) {
                const safe = "u-" + cat.replace(/[&\s]+/g, '-').toLowerCase();
                // Click to toggle collapse
                let h = `<div class="header-row" id="h-${safe}" onclick="toggleCollapse('${safe}')"><h2>${cat}</h2><span class="cat-pct" id="pct-${safe}">0%</span></div><div class="grid-tidy" data-category="${safe}">`;
                uniqueWeaponData[cat].forEach(w => {
                    h += `<div class="grid-item"><input type="checkbox" class="u-wpn-check" onchange="calcCat('${safe}'); triggerAutosave();"><span>${w}</span></div>`;
                });
                div.insertAdjacentHTML('beforeend', h + `</div>`);
            }
        });
    }

    function renderCollectibles() {
        const div = document.getElementById('coll-list'); div.innerHTML = ''; 
        if(origin === 'CW') {
            div.innerHTML = `
                <div class="header-row" id="h-special-bobble" onclick="toggleCollapse('special-bobble')"><h2>BOBBLEHEADS: S.P.E.C.I.A.L.</h2></div>
                <div class="grid-tidy" data-category="special-bobble">${sKeys.map(s=>`<div class="grid-item"><input type="checkbox" onchange="triggerAutosave()"><span>${s}</span></div>`).join('')}</div>
                <div class="header-row" id="h-skill-bobble" onclick="toggleCollapse('skill-bobble')"><h2>BOBBLEHEADS: SKILLS</h2></div>
                <div class="grid-tidy" data-category="skill-bobble">${skills.map(s=>`<div class="grid-item"><input type="checkbox" onchange="triggerAutosave()"><span>${s}</span></div>`).join('')}</div>`;
        } else {
            div.innerHTML = `
                <div class="header-row" id="h-snow-base" onclick="toggleCollapse('snow-base')"><h2>SNOWGLOBES: BASE GAME</h2></div>
                <div class="grid-tidy" data-category="snow-base">${["GOODSPRINGS","STRIP","HOOVER DAM","MT. CHARLESTON","NELLIS","MORMON FORT","TEST SITE"].map(s=>`<div class="grid-item"><input type="checkbox" onchange="triggerAutosave()"><span>${s}</span></div>`).join('')}</div>
                <div class="header-row" id="h-snow-dlc" onclick="toggleCollapse('snow-dlc')"><h2>SNOWGLOBES: DLC</h2></div>
                <div class="grid-tidy" data-category="snow-dlc">${["SIERRA MADRE","ZION","BIG MT","THE DIVIDE"].map(s=>`<div class="grid-item"><input type="checkbox" onchange="triggerAutosave()"><span>${s}</span></div>`).join('')}</div>`;
        }
    }

    /* --- DATA MANAGEMENT --- */
    function calcCat(id) {
        const g = document.querySelector(`.grid-tidy[data-category="${id}"]`);
        if(!g) return;
        const checks = Array.from(g.querySelectorAll('input[type="checkbox"]'));
        const pct = Math.round((checks.filter(c => c.checked).length / checks.length) * 100);
        const pctEl = document.getElementById(`pct-${id}`);
        if(pctEl) pctEl.innerText = pct === 100 ? "DONE" : pct + "%";
        document.getElementById(`h-${id}`).classList.toggle('completed', pct === 100);
    }

    function updateAll() {
        const pool = (mode === 'hc' ? 30 : 33);
        const rem = pool - (Object.values(special).reduce((a,b)=>a+b,0) - 7);
        document.getElementById('pts-left').innerText = rem;
        document.getElementById('special-list').innerHTML = sKeys.map(k => `
            <div class="special-row"><span>${k}</span>
            <div class="special-controls"><button class="special-btn" onclick="mod('${k}',-1)" ${special[k]<=1?'disabled':''}>-</button>
            <b>${special[k]}</b><button class="special-btn" onclick="mod('${k}',1)" ${rem<=0 || special[k]>=10?'disabled':''}>+</button></div></div>`).join('');

        document.getElementById('ov-name').innerText = (document.getElementById('char-name').value || "NO_ID").toUpperCase();
        document.getElementById('ov-spec').innerHTML = sKeys.map(k => `<div><div style="font-size:0.6rem;">${k}</div><b>${special[k]}</b></div>`).join('');
        document.getElementById('ov-tags').innerHTML = Array.from(document.querySelectorAll('#tag-area input:checked')).map(c => `<div class="ov-entry"><span>${c.nextElementSibling.innerText}</span></div>`).join('') || "NONE";
        document.getElementById('ov-traits').innerHTML = Array.from(document.querySelectorAll('#trait-list input')).map(i => i.value ? `<div class="ov-entry"><span>â€¢ ${i.value}</span></div>` : '').join('') || "NONE";
        
        document.getElementById('ov-perks').innerHTML = Array.from(document.querySelectorAll('#prog-list .prog-row')).map(r => {
            const lvl = r.querySelector('.lvl-tag').innerText;
            const val = r.querySelector('input:first-of-type').value;
            return val ? `<div class="ov-entry"><span>${val}</span><span style="opacity:0.6;">${lvl}</span></div>` : '';
        }).join('') + Array.from(document.querySelectorAll('#extra-perk-list .prog-row')).map(r => {
            const val = r.querySelector('input:first-of-type').value;
            return val ? `<div class="ov-entry"><span>${val}</span><span style="opacity:0.6;">BONUS</span></div>` : '';
        }).join('');

        let gearHTML = Array.from(document.querySelectorAll('#weapon-list .gear-card')).map(c => {
            const n = c.querySelector('input[placeholder="WEAPON NAME..."]').value;
            const a = c.querySelector('input[placeholder="AMMO TYPE..."]').value;
            return n ? `<div class="ov-entry"><span>âš” ${n}</span><span style="opacity:0.6;">${a}</span></div>` : '';
        }).join('');
        gearHTML += Array.from(document.querySelectorAll('#armor-list .gear-card')).map(c => {
            const n = c.querySelector('input[placeholder="APPAREL NAME..."]').value;
            const w = c.querySelector('select').value;
            return n ? `<div class="ov-entry"><span>ðŸ›¡ ${n}</span><span style="opacity:0.6;">${w}</span></div>` : '';
        }).join('');
        document.getElementById('ov-gear').innerHTML = gearHTML || "EMPTY";

        syncTagLimit();
    }

    function mod(k, v) { special[k] += v; updateAll(); triggerAutosave(); }
    
    function addTrait() { 
        if(mode==='hc' && document.getElementById('trait-list').children.length>=5) return;
        document.getElementById('trait-list').insertAdjacentHTML('beforeend', `<div style="display:flex; margin-bottom:2px;"><input type="text" oninput="triggerAutosave()" style="flex:1; background:transparent; border:none; border-bottom:1px solid #444; color:#fff;" placeholder="TRAIT NAME..."><button onclick="this.parentElement.remove();updateAll();triggerAutosave();" style="color:red; background:none; border:none; cursor:pointer;">X</button></div>`); 
        updateAll(); 
    }
    
    function addWeapon() { document.getElementById('weapon-list').insertAdjacentHTML('beforeend', `<div class="gear-card"><input type="text" oninput="triggerAutosave()" placeholder="WEAPON NAME..."><input type="text" oninput="triggerAutosave()" placeholder="LOCATION..."><input type="text" oninput="triggerAutosave()" placeholder="AMMO TYPE..."><button onclick="this.parentElement.remove();updateAll();triggerAutosave();" style="position:absolute; right:5px; top:5px; color:red; background:none; border:none; cursor:pointer;">X</button></div>`); }
    function addArmor() { document.getElementById('armor-list').insertAdjacentHTML('beforeend', `<div class="gear-card"><input type="text" oninput="triggerAutosave()" placeholder="APPAREL NAME..."><input type="text" oninput="triggerAutosave()" placeholder="LOCATION..."><select onchange="triggerAutosave()"><option>LIGHT</option><option>MEDIUM</option><option>HEAVY</option><option>POWER ARMOR</option></select><button onclick="this.parentElement.remove();updateAll();triggerAutosave();" style="position:absolute; right:5px; top:5px; color:red; background:none; border:none; cursor:pointer;">X</button></div>`); }
    function addExtraPerk() { document.getElementById('extra-perk-list').insertAdjacentHTML('beforeend', `<div class="prog-row"><button onclick="this.parentElement.remove();updateAll();triggerAutosave();" style="position:absolute; right:2px; top:2px; color:red; background:none; border:none; cursor:pointer; font-size:10px;">X</button><div class="lvl-tag">BONUS</div><input type="text" oninput="triggerAutosave()" placeholder="PERK NAME..."><input type="text" oninput="triggerAutosave()" style="border-top:1px solid #222;" placeholder="SOURCE..."></div>`); }

    function renderProgression() {
        const div = document.getElementById('prog-list'); div.innerHTML = '';
        for(let i=2; i<=30; i++) {
            const isP = mode === 'std' ? (i%2===0) : (i%3===0);
            const isT = (i>=5 && (i-5)%4===0);
            if(isP || isT) div.insertAdjacentHTML('beforeend', `<div class="prog-row"><div class="lvl-tag">LVL ${i} ${isT?'TRAIT':'PERK'}</div><input type="text" oninput="triggerAutosave()" placeholder="NAME..."><input type="text" oninput="triggerAutosave()" style="border-top:1px solid #222; color:#888; font-size:0.6rem;" placeholder="REQUIREMENTS / NOTES..."></div>`);
        }
    }

    function syncTagLimit() {
        const cbs = Array.from(document.querySelectorAll('#tag-area input'));
        const count = cbs.filter(c => c.checked).length;
        cbs.forEach(c => {
            if(!c.checked && count >= 3) { c.disabled = true; c.parentElement.classList.add('locked'); }
            else { c.disabled = false; c.parentElement.classList.remove('locked'); }
        });
        document.getElementById('add-trait-btn').disabled = (mode==='hc' && document.getElementById('trait-list').children.length>=5);
    }

    /* --- AUTOSAVE & PERSISTENCE --- */
    function triggerAutosave() {
        const data = collectData();
        localStorage.setItem('Nuclear_Sunset_Permanent_Vault', JSON.stringify(data));
        document.getElementById('sync-status').innerText = "V_MEMORY_SYNCED_" + new Date().toLocaleTimeString();
        updateAll();
    }

    function collectData() {
        // UPDATE REGIONAL STORAGE WITH CURRENT VIEW BEFORE SAVING
        regionalStorage[origin].quests = Array.from(document.querySelectorAll('#quest-list-container input')).map(i => i.checked);
        regionalStorage[origin].colls = Array.from(document.querySelectorAll('#coll-list input')).map(i => i.checked);

        return {
            name: document.getElementById('char-name').value, special, mode, origin,
            regionalStorage, // INCLUDE THE NEW PERSISTENT OBJECT
            notes: document.getElementById('user-notes').value,
            tags: Array.from(document.querySelectorAll('#tag-area input')).map(i => i.checked),
            traits: Array.from(document.querySelectorAll('#trait-list input')).map(i => i.value),
            perks: Array.from(document.querySelectorAll('#prog-list .prog-row')).map(r => Array.from(r.querySelectorAll('input')).map(i => i.value)),
            extraPerks: Array.from(document.querySelectorAll('#extra-perk-list .prog-row')).map(r => Array.from(r.querySelectorAll('input')).map(i => i.value)),
            weapons: Array.from(document.querySelectorAll('#weapon-list .gear-card')).map(c => Array.from(c.querySelectorAll('input')).map(i => i.value)),
            armor: Array.from(document.querySelectorAll('#armor-list .gear-card')).map(c => [c.querySelector('input[placeholder="APPAREL NAME..."]').value, c.querySelector('input[placeholder="LOCATION..."]').value, c.querySelector('select').value]),
            quests: Array.from(document.querySelectorAll('#quest-list-container input')).map(i => i.checked),
            colls: Array.from(document.querySelectorAll('#coll-list input')).map(i => i.checked),
            uniWpns: Array.from(document.querySelectorAll('.u-wpn-check')).map(i => i.checked)
        };
    }

    function exportJSON() {
        const data = collectData();
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${data.name || 'dweller'}.json`; a.click();
    }

    function importJSON(e) {
        const reader = new FileReader();
        reader.onload = (ev) => hydrate(JSON.parse(ev.target.result));
        reader.readAsText(e.target.files[0]);
    }

    function hydrate(d) {
        if(!d) return;
        special = d.special; document.getElementById('char-name').value = d.name || "";
        document.getElementById('user-notes').value = d.notes || "";
        
        // RECOVER REGIONAL PROGRESS
        if(d.regionalStorage) regionalStorage = d.regionalStorage;

        setMode(d.mode, true); 
        setOrigin(d.origin, true); // THIS CALLS RENDERERS AND LOADS THE CORRECT CHECKBOXES
        
        const tI = document.querySelectorAll('#tag-area input'); d.tags.forEach((c, i) => { if(tI[i]) tI[i].checked = c; });
        document.getElementById('trait-list').innerHTML = ''; d.traits.forEach(v => { if(v) { addTrait(); document.querySelector('#trait-list div:last-child input').value = v; }});
        document.getElementById('weapon-list').innerHTML = ''; d.weapons.forEach(v => { addWeapon(); const i = document.querySelectorAll('#weapon-list .gear-card:last-child input'); i[0].value = v[0]; i[1].value = v[1]; i[2].value = v[2]; });
        document.getElementById('armor-list').innerHTML = ''; d.armor.forEach(v => { addArmor(); const c = document.querySelector('#armor-list .gear-card:last-child'); c.querySelector('input[placeholder="APPAREL NAME..."]').value = v[0]; c.querySelector('input[placeholder="LOCATION..."]').value = v[1]; c.querySelector('select').value = v[2]; });
        const pI = document.querySelectorAll('#prog-list .prog-row'); d.perks.forEach((v, i) => { if(pI[i]) { const ins = pI[i].querySelectorAll('input'); ins[0].value = v[0]; ins[1].value = v[1]; }});
        
        const uC = document.querySelectorAll('.u-wpn-check'); if(d.uniWpns) d.uniWpns.forEach((c, i) => { if(uC[i]) uC[i].checked = c; });
        
        updateAll();
    }

    function purgeMemory() { if(confirm("INITIATE TOTAL ATOMIC ANNIHILATION?")) { localStorage.clear(); location.reload(); } }

    /* --- INITIALIZATION --- */
    window.onload = () => {
        document.getElementById('tag-area').innerHTML = skills.map(s => `<div class="grid-item"><input type="checkbox" onchange="triggerAutosave()"><span>${s}</span></div>`).join('');
        renderUniques();
        
        const saved = localStorage.getItem('Nuclear_Sunset_Permanent_Vault');
        if (saved) {
            hydrate(JSON.parse(saved));
        } else {
            setMode('std', true); 
            setOrigin('CW', true);
        }
    };
</script>
</body>
</html>