<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NUCLEAR_SUNSET.EXE // TTW_EDITION</title>
    <style>
        :root { 
            --pip-color: #28ff28; 
            --pip-bg: #050f05; 
            --pip-border: #28ff28; 
            --warning-gold: #ffce20; 
            --danger-red: #ff4444; 
            --font-main: 'Courier New', Courier, monospace;
        }
        
        body.theme-cw:not(.mode-hc) { --pip-color: #28ff28; --pip-border: #1a441a; --pip-bg: #050f05; }
        body.theme-mw:not(.mode-hc) { --pip-color: #ffb642; --pip-border: #44331a; --pip-bg: #0f0a05; }
        
        body.mode-hc { 
            --pip-color: var(--danger-red); 
            --pip-border: #800; 
            --pip-bg: #000;
            background-color: #000; 
        }
        body.mode-hc header { border-color: var(--danger-red); box-shadow: 0 0 20px #f00; }

        body { background-color: #0a0a0a; color: var(--pip-color); font-family: var(--font-main); margin: 0; overflow: hidden; height: 100vh; font-size: 13px; }
        input, button, select, textarea, span, div, a { font-family: var(--font-main) !important; text-transform: uppercase; }
        a { color: var(--pip-color); text-decoration: underline; cursor: pointer; }

        .wrapper { display: grid; grid-template-columns: 340px 1fr 320px; grid-template-rows: 125px 1fr; height: 100vh; gap: 10px; padding: 10px; box-sizing: border-box; }
        
        header { 
            grid-column: 1 / span 3; display: flex; flex-direction: column; justify-content: center; 
            border: 2px solid var(--pip-color); padding: 8px 15px; background: var(--pip-bg); 
            position: relative;
        }
        
        .header-top { display: flex; justify-content: space-between; align-items: flex-start; width: 100%; }
        .sysadmin-note { font-size: 0.7rem; color: #fff; background: #800; padding: 3px 8px; margin-top: 4px; display: inline-block; border: 1px solid var(--danger-red); font-weight: bold; }

        .os-title { font-weight: bold; font-size: 1.2rem; letter-spacing: 2px; margin-top: 2px; }
        .subroutine { font-size: 0.8rem; color: var(--danger-red); animation: blink 0.5s infinite; font-weight: bold; border: 1px solid var(--danger-red); padding: 3px 10px; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } }

        .header-controls { display: flex; gap: 15px; margin-top: 8px; font-size: 0.75rem; }
        .toggle-group { display: flex; border: 1px solid var(--pip-color); }
        .toggle-group button { background: none; border: none; color: var(--pip-color); padding: 4px 10px; cursor: pointer; font-size: 0.7rem; }
        .toggle-group button.active { background: var(--pip-color); color: black; }

        section { border: 2px solid var(--pip-border); background: var(--pip-bg); display: flex; flex-direction: column; padding: 12px; overflow: hidden; }
        
        .special-btn { background: none; border: 1px solid var(--pip-color); color: var(--pip-color); width: 28px; height: 28px; cursor: pointer; font-weight: bold; }
        .special-btn:hover:not(:disabled) { background: var(--pip-color); color: black; }
        .special-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        .grid-tidy { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .grid-item { display: flex; align-items: center; gap: 6px; padding: 6px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); font-size: 0.75rem; }
        .grid-item.tagged { background: var(--pip-color); color: black; font-weight: bold; }

        .dual-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: 100%; }
        .dual-col { display: flex; flex-direction: column; }
        .dual-row { display: grid; grid-template-columns: 30px 1fr; gap: 5px; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05); align-items: center; }
        .dual-header { padding: 6px; background: var(--pip-color); color: black; font-weight: bold; font-size: 0.75rem; text-align: center; }
        
        .prog-row { display: grid; grid-template-columns: 25px 40px 1fr 1fr; gap: 4px; padding: 3px 0; border-bottom: 1px solid rgba(255,255,255,0.05); align-items: center; }
        .prog-header { display: grid; grid-template-columns: 25px 40px 1fr 1fr; padding: 6px; background: var(--pip-color); color: black; font-weight: bold; font-size: 0.6rem; }

        .tag-p { color: black; background: var(--pip-color); font-size: 0.5rem; font-weight: bold; text-align: center; padding: 2px; }
        .tag-t { color: black; background: var(--warning-gold); font-size: 0.5rem; font-weight: bold; text-align: center; padding: 2px; }

        .gear-card { border: 1px solid rgba(255,255,255,0.1); padding: 8px; margin-bottom: 10px; background: rgba(0,0,0,0.3); position: relative; }
        .gear-card input { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.15); width: 100%; box-sizing: border-box; }
        .gear-card input:focus { border-bottom: 1px solid var(--pip-color); outline: none; }

        h2 { background: var(--pip-color); color: black; font-size: 0.8rem; text-align: center; margin: 8px 0; padding: 3px; font-weight: bold; }
        .scroll-v { overflow-y: auto; flex-grow: 1; scrollbar-width: thin; scrollbar-color: var(--pip-color) transparent; }
        input[type="text"] { background: transparent; border: none; color: #fff; font-size: 0.75rem; padding: 2px; }
        
        .tab-nav { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab-nav button { flex: 1; padding: 8px; background: rgba(255,255,255,0.05); color: var(--pip-color); border: 1px solid var(--pip-border); cursor: pointer; font-size: 0.7rem; }
        .tab-nav button.active { background: var(--pip-color); color: black; }

        .action-btn { height: 35px; background: none; border: 1px solid var(--pip-color); color: var(--pip-color); cursor: pointer; font-size: 0.7rem; font-weight: bold; }
        .action-btn:hover:not(:disabled) { background: var(--pip-color); color: black; }
        .action-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .danger-btn { border-color: var(--danger-red); color: var(--danger-red); margin-top: 5px; }

        .credits-box { font-size: 0.65rem; border: 1px solid rgba(255,255,255,0.1); padding: 8px; line-height: 1.4; margin-top: 10px; }
    </style>
</head>
<body class="theme-cw">

<div class="wrapper">
    <header id="main-header">
        <div class="header-top">
            <div>
                <div class="file-path">GASSY:/PROJECTS/NUCLEAR_SUNSET/<span id="os-status">AUTHORIZED_USER</span></div>
                <div id="sysadmin-note" class="sysadmin-note" style="display:none;">FEEDBACK TO SYSADMIN: <b>FINALCATALYST</b></div>
            </div>
            <span id="hc-warning" class="subroutine" style="display:none;">SYS_OVERRIDE_ACTIVE</span>
        </div>
        <div class="os-title">NUCLEAR_SUNSET.EXE // TTW_EDITION</div>
        <div class="header-controls">
            <div style="display:flex; align-items:center; gap:8px;">REGION:
                <div class="toggle-group">
                    <button id="btn-cw" class="active" onclick="setOrigin('CW')">CAPITAL</button>
                    <button id="btn-mw" onclick="setOrigin('MW')">MOJAVE</button>
                </div>
            </div>
            <div style="display:flex; align-items:center; gap:8px;">MODE:
                <div class="toggle-group">
                    <button id="m-std" class="active" onclick="setMode('std')">STANDARD</button>
                    <button id="m-hc" onclick="setMode('hc')">HARDERCORE</button>
                </div>
            </div>
        </div>
    </header>

    <section>
        <div class="scroll-v">
            <h2>Identity</h2>
            <input type="text" id="char-name" placeholder="SUBJECT_ID">
            <h2>S.P.E.C.I.A.L.</h2>
            <div style="text-align:center; font-size:0.8rem; margin-bottom:8px;">POOL: <span id="pool-count">5</span></div>
            <div id="special-list"></div>
            <h2>Tags (<span id="tag-count">0</span>/3)</h2>
            <div id="tag-area" class="grid-tidy"></div>
            <h2>Initial Traits</h2>
            <div id="trait-list"></div>
            <button id="add-trait-btn" class="action-btn" style="width:100%; margin-top:5px;" onclick="addStartingTrait()">+ TRAIT</button>
        </div>
    </section>

    <section>
        <div class="tab-nav">
            <button onclick="showTab('prog')" id="tab-btn-prog" class="active">Progression</button>
            <button onclick="showTab('gear')" id="tab-btn-gear">Loadout</button>
            <button onclick="showTab('coll')" id="tab-btn-coll">Collectibles</button>
        </div>

        <div id="tab-prog" class="tab-content scroll-v" style="height:100%;">
            <div class="dual-container">
                <div class="dual-col">
                    <div class="prog-header"><div>LV</div><div>TYPE</div><div>NAME</div><div>REQ</div></div>
                    <div id="prog-left"></div>
                </div>
                <div class="dual-col">
                    <div class="prog-header"><div>LV</div><div>TYPE</div><div>NAME</div><div>REQ</div></div>
                    <div id="prog-right"></div>
                </div>
            </div>
        </div>

        <div id="tab-gear" class="tab-content scroll-v" style="display:none;">
            <div class="dual-container">
                <div class="dual-col">
                    <h2>Weapons</h2>
                    <div id="weapon-list"></div>
                    <button class="action-btn" onclick="addWeapon()">+ ADD WEAPON</button>
                </div>
                <div class="dual-col">
                    <h2>Apparel</h2>
                    <div id="armor-list"></div>
                    <button class="action-btn" onclick="addArmor()">+ ADD ARMOR</button>
                </div>
            </div>
        </div>

        <div id="tab-coll" class="tab-content scroll-v" style="display:none;">
            <div id="cw-coll" class="dual-container">
                <div class="dual-col">
                    <div class="dual-header">S.P.E.C.I.A.L. BOBBLEHEADS</div>
                    <div id="b-special-grid"></div>
                </div>
                <div class="dual-col">
                    <div class="dual-header">SKILL BOBBLEHEADS</div>
                    <div id="b-skill-grid"></div>
                </div>
            </div>
            <div id="mw-coll" style="display:none;" class="dual-container">
                <div class="dual-col">
                    <div class="dual-header">MOJAVE SNOWGLOBES</div>
                    <div id="s-grid-left"></div>
                </div>
                <div class="dual-col">
                    <div class="dual-header">REGION ASSETS</div>
                    <div id="s-grid-right"></div>
                </div>
            </div>
        </div>
    </section>

    <section>
        <h2>Terminal</h2>
        <textarea id="term-log" style="flex:1; background:black; color:var(--pip-color); border:1px solid var(--pip-border); padding:8px; resize:none; font-size: 0.8rem;"></textarea>
        
        <div class="credits-box">
            <div style="font-weight:bold; color:var(--pip-color); border-bottom:1px solid; margin-bottom:4px;">CREDITS & DATA</div>
            SPECIAL THANKS TO THE CREATORS AT <a href="https://nuclearsunset.com/" target="_blank">NUCLEARSUNSET.COM</a>:<br>
            DARKSOLARLEGEND, ORGASMICSNEEZE, DOKTORAKCEL, LIME, AND FINALCATALYST.
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:5px; align-items: end;">
            <div style="font-size: 0.6rem; opacity: 0.8;">CREATED AND MAINTAINED BY GASSY</div>
            <div style="display:flex; gap:5px;">
                <button class="action-btn" style="flex:1" onclick="saveBuild()">ðŸ’¾ SAVE</button>
                <button class="action-btn" style="flex:1" onclick="document.getElementById('load-trigger').click()">ðŸ“‚ LOAD</button>
            </div>
            <input type="file" id="load-trigger" style="display:none;" onchange="loadBuild(event)">
            <button class="action-btn danger-btn" style="grid-column: 1/span 2;" onclick="systemWipe()">â˜¢ SYSTEM_WIPE</button>
        </div>
    </section>
</div>

<script>
    let mode = 'std', origin = 'CW', special = { STR: 5, PER: 5, END: 5, CHA: 5, INT: 5, AGI: 5, LCK: 5 };
    const fullSkills = ["Barter", "Energy Weapons", "Explosives", "Guns", "Lockpick", "Medicine", "Melee Weapons", "Repair", "Science", "Sneak", "Speech", "Survival", "Unarmed"];
    const bhSpecial = ["Strength", "Perception", "Endurance", "Charisma", "Intelligence", "Agility", "Luck"];
    const bhSkills = ["Barter", "Energy Weapons", "Explosives", "Guns", "Lockpick", "Medicine", "Melee Weapons", "Repair", "Science", "Sneak", "Speech", "Unarmed"];
    const sg = ["Goodsprings", "Hoover Dam", "Mormon Fort", "Mt. Charleston", "Nellis", "The Strip", "Test Site"];

    function setMode(m) {
        mode = m;
        document.body.classList.toggle('mode-hc', m === 'hc');
        document.getElementById('hc-warning').style.display = (m === 'hc') ? 'inline' : 'none';
        document.getElementById('sysadmin-note').style.display = (m === 'hc') ? 'inline-block' : 'none';
        document.getElementById('os-status').innerText = (m === 'hc') ? 'OVERRIDE_ACTIVE' : 'AUTHORIZED_USER';
        document.getElementById('m-std').className = (m === 'std') ? 'active' : '';
        document.getElementById('m-hc').className = (m === 'hc') ? 'active' : '';
        checkTraitBtn();
        renderProgression();
        updateUI();
    }

    function setOrigin(o) {
        origin = o;
        if(mode !== 'hc') document.body.className = (o === 'CW' ? 'theme-cw' : 'theme-mw');
        document.getElementById('btn-cw').className = (o === 'CW') ? 'active' : '';
        document.getElementById('btn-mw').className = (o === 'MW') ? 'active' : '';
        document.getElementById('cw-coll').style.display = (o === 'CW') ? 'grid' : 'none';
        document.getElementById('mw-coll').style.display = (o === 'MW') ? 'grid' : 'none';
    }

    function updateUI() {
        const limit = (mode === 'std') ? 40 : 37;
        const used = Object.values(special).reduce((a, b) => a + b, 0);
        document.getElementById('pool-count').innerText = limit - used;
        document.getElementById('special-list').innerHTML = Object.keys(special).map(s => `
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                <span style="font-weight:bold;">${s}</span>
                <div style="display:flex; align-items:center; gap:10px;">
                    <button class="special-btn" onclick="mod('${s}',-1)">-</button>
                    <span style="width:20px; text-align:center; font-weight:bold;">${special[s]}</span>
                    <button class="special-btn" onclick="mod('${s}',1)">+</button>
                </div>
            </div>`).join('');

        const tagArea = document.getElementById('tag-area');
        if (tagArea.innerHTML === "") {
            tagArea.innerHTML = fullSkills.map(s => `<div class="grid-item">
                <input type="checkbox" onchange="handleSkill(this)"><span>${s}</span>
            </div>`).join('');
        }

        if (document.getElementById('b-special-grid').innerHTML === "") {
            document.getElementById('b-special-grid').innerHTML = bhSpecial.map(n => `<div class="dual-row"><input type="checkbox"><span>${n}</span></div>`).join('');
            document.getElementById('b-skill-grid').innerHTML = bhSkills.map(n => `<div class="dual-row"><input type="checkbox"><span>${n}</span></div>`).join('');
            document.getElementById('s-grid-left').innerHTML = sg.slice(0, 4).map(n => `<div class="dual-row"><input type="checkbox"><span>${n}</span></div>`).join('');
            document.getElementById('s-grid-right').innerHTML = sg.slice(4).map(n => `<div class="dual-row"><input type="checkbox"><span>${n}</span></div>`).join('');
        }
    }

    function renderProgression() {
        const left = document.getElementById('prog-left');
        const right = document.getElementById('prog-right');
        const step = (mode === 'std') ? 2 : 3;
        const traitLevels = [5, 9, 13, 17, 21, 25, 29, 33, 37, 41, 45, 49, 53, 57];

        const buildCols = (start, end, container) => {
            container.innerHTML = '';
            for (let i = start; i <= end; i++) {
                let row = '';
                if (i % step === 0) row += `<div class="prog-row"><div>${i}</div><div class="tag-p">PERK</div><input type="text"><input type="text"></div>`;
                if (traitLevels.includes(i)) row += `<div class="prog-row"><div>${i}</div><div class="tag-t">TRAIT</div><input type="text"><input type="text"></div>`;
                if (row !== '') container.innerHTML += row;
            }
        };
        buildCols(2, 30, left);
        buildCols(31, 60, right);
    }

    function mod(s, v) {
        const limit = mode === 'std' ? 40 : 37;
        const used = Object.values(special).reduce((a,b)=>a+b,0);
        if(v > 0 && used >= limit) return;
        if(v < 0 && special[s] <= 1) return;
        special[s] += v; updateUI();
    }

    function addWeapon() {
        const div = document.createElement('div');
        div.className = 'gear-card';
        div.innerHTML = `<button style="position:absolute; top:2px; right:2px; background:red; border:none; color:white; cursor:pointer;" onclick="this.parentElement.remove()">X</button>
                         <input type="text" placeholder="WEAPON NAME">
                         <input type="text" placeholder="AMMO TYPE">
                         <input type="text" placeholder="LOCATION FOUND">`;
        document.getElementById('weapon-list').appendChild(div);
    }

    function addArmor() {
        const div = document.createElement('div');
        div.className = 'gear-card';
        div.innerHTML = `<button style="position:absolute; top:2px; right:2px; background:red; border:none; color:white; cursor:pointer;" onclick="this.parentElement.remove()">X</button>
                         <input type="text" placeholder="APPAREL NAME">
                         <input type="text" placeholder="WEIGHT CLASS">
                         <input type="text" placeholder="LOCATION FOUND">`;
        document.getElementById('armor-list').appendChild(div);
    }

    function addStartingTrait() {
        const list = document.getElementById('trait-list');
        if (mode === 'hc' && list.children.length >= 5) return;
        const div = document.createElement('div');
        div.style.display = 'flex'; div.style.marginBottom = '4px';
        div.innerHTML = `<input type="text" style="flex:1" placeholder="TRAIT">
                         <button style="color:red; border:none; background:none; cursor:pointer;" onclick="this.parentElement.remove(); checkTraitBtn()">X</button>`;
        list.appendChild(div);
        checkTraitBtn();
    }

    function checkTraitBtn() {
        const list = document.getElementById('trait-list');
        document.getElementById('add-trait-btn').disabled = (mode === 'hc' && list.children.length >= 5);
    }

    function handleSkill(cb) {
        const tagged = document.querySelectorAll('#tag-area input:checked');
        document.querySelectorAll('#tag-area input').forEach(input => {
            input.parentElement.classList.toggle('tagged', input.checked);
            if (!input.checked) input.disabled = tagged.length >= 3;
        });
        document.getElementById('tag-count').innerText = tagged.length;
    }

    function showTab(t) {
        document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
        document.querySelectorAll('.tab-nav button').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-' + t).style.display = 'block';
        document.getElementById('tab-btn-' + t).classList.add('active');
    }

    function systemWipe() {
        if (confirm("â˜¢ FACTORY RESET INITIATED. WIPE ALL DATA?")) location.reload();
    }

    function saveBuild() {
        const data = { special, name: document.getElementById('char-name').value, origin, mode };
        const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${data.name || 'vault_export'}.json`;
        a.click();
    }

    function loadBuild(e) {
        const reader = new FileReader();
        reader.onload = (ev) => {
            const data = JSON.parse(ev.target.result);
            special = data.special;
            document.getElementById('char-name').value = data.name;
            setOrigin(data.origin);
            setMode(data.mode);
        };
        reader.readAsText(e.target.files[0]);
    }

    window.onload = () => { renderProgression(); updateUI(); };
</script>
</body>
</html>